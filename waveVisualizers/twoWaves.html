
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">

    <title>TinkRworks | Mixed Wave Visualizer</title>

    <link rel="stylesheet" href="pure.css">
      <link rel="shortcut icon" href="favicon.ico" />
      <link href="https://fonts.googleapis.com/css2?family=Abel&display=swap" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <style>
      /*
        orange: #FF9300;
        blue:; #2E5390;
        dark blue: #10005D;
        green: #00BF3F;
        gray: #94969A;
      */



      body {
        font-family: 'Montserrat', sans-serif;
        /* background-color: #2E5390; */
        background-color: #fbfbfb;
        color: #222;
        line-height: 1.6;
        min-width:900px;
      }


      h1{
        text-align:center;
        font-family: 'Abel', sans-serif;
        font-weight: 400;
        margin: 0;
      }

      #content {
        position: relative;
        width: 900px;
        height: 950px;
        margin: 0 auto;
        /* background-color: #fff; */
        background-color: #2E5390; 
        color: #fff;
        border-radius: 10px;
        padding: 20px;
      }

      .waveControlsDiv{  /* box for pull-down menu and buttons */
        width: 150px;
        position: absolute;
        left: 0px;
        text-align: right;
      }
      #waveControlsDiv1{
        top: 130px;
      }
      #waveControlsDiv2{
        top: 430px;
      }
      #waveControlsDiv3{
        top: 730px;
      }

      .waveformCanvasDiv{  /* canvas for visualization */
        margin-top: 20px;
        position: absolute;
        left: 250px;
      }
      #waveformCanvasDiv1{
        top:100px;
      }
      #waveformCanvasDiv2{
        top:400px;
      }
      #waveformCanvasDiv3{
        top:700px;
      }

      .waveFormSelectDiv{
        margin-top: 20px;
      }

      .waveFormSelect{
        width: 90px;
        text-align: center;
      }

      .controlButtons{
        margin-top: 20px;
        width: 90px;
        color:rgba(0,0,0,0.8);
        border: none transparent;
        background-color: #e6e6e6;
        border-radius: 2px;
      }

      .freqSliderDiv{    /* box for frequency slider below canvas */
        position: absolute;
        left: 253px;
      }
      #freqSliderDiv1{
        top: 350px;
      }
      #freqSliderDiv2{
        top: 650px;
      }

      .volSliderDiv{   /* box for vertical volume slider */
        position: absolute;
        left:175px;
        text-align: center;
      }
      #volSliderDiv1{
        top: 100px;
      }
      #volSliderDiv2{
        top: 400px;
      }

      .volSlider{
        -webkit-appearance: slider-vertical;
        width: 15px;
        height: 225px;
      }

      .waveCanvas{
        border: 1px solid #000; 
        width: 475px; 
        height: 225px; 
        background:#e6e6e6;
      }


      .textBox{
        width:35px;
      }

       #logo {
        text-align: center;
      }

    </style>


  </head>

  <body>

    <div id="logo">
      <a href="index.html"><img src="https://cdn.glitch.global/eacacab5-f7e6-4c92-baf4-25598e8091b9/logo.png?v=1653673276653" width="300px" /></a>
    </div>
    <div id="content">
      <h1>Visualize Mixed Waves</h1>

  
      <!-- start of wave 1-->
      <div class="waveControlsDiv" id="waveControlsDiv1">

        <div class="waveFormSelectDiv">
          <label for="waveform1" style="text-align:center;">Shape:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></label>
          <select class="waveFormSelect" id="waveform1" onchange="if(wave1on){changeWave(1);}">
            <option value="sine" selected>Sine</option>
            <option value="square">Square</option>
            <option value="sawtooth">Sawtooth</option>
            <option value="triangle">Triangle</option>
            <!--<option value="custom">Custom</option>-->
          </select>
        </div> <!-- end of waveFormSelect-->

        <div><!-- start of control buttons-->
          <button  class="controlButtons" onclick="startWave1()">Start wave</button><br>
          <button  class="controlButtons" onclick="stopWave(1)">Stop wave</button><br>
        </div> <!-- end of controlButtons-->
      </div> <!-- end of waveControls-->
        

      <div class="volSliderDiv" id="volSliderDiv1">
        <span>Amplitude</span><br>
        <input class="volSlider" type="range" id="volumeSlider1" min="0" max="2" value="1" step="0.01" oninput="if(wave1on){changeVol(1);}">
      </div> <!-- end of volSlider-->

    

      <div class="waveformCanvasDiv" id="waveformCanvasDiv1">
        <canvas id="waveCanvas1" class="waveCanvas"></canvas>
      </div> <!-- end of waveformCanvas -->


      <div class="freqSliderDiv" id="freqSliderDiv1">
        <span>Frequency: </span>
        <input id="freqSlider1" type="range" min="0" max="1500" value="440" style="width:330px" oninput="updateFreqTextBox(1);if(wave1on){changeFreq(1);}">
        <input id="freqText1" type="text" class="textBox" value="440" onchange="updateFreqSlider(1);if(wave1on){changeFreq(1);}">
      </div> <!-- end of freqSlider -->
    <!--end of wave 1-->


    <!-- start of wave 2 -->
   <div class="waveControlsDiv" id="waveControlsDiv2">

        <div class="waveFormSelectDiv">
          <label for="waveform2" style="text-align:center;">Shape:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></label>
          <select class="waveFormSelect" id="waveform2" onchange="if(wave1on){changeWave(2);}">
            <option value="sine" selected>Sine</option>
            <option value="square">Square</option>
            <option value="sawtooth">Sawtooth</option>
            <option value="triangle">Triangle</option>
            <!--<option value="custom">Custom</option>-->
          </select>
        </div> <!-- end of waveFormSelect-->

        <div><!-- start of control buttons-->
          <button  class="controlButtons" onclick="startWave2()">Start wave</button><br>
          <button  class="controlButtons" onclick="stopWave(2)">Stop wave</button><br>
        </div> <!-- end of controlButtons-->
      </div> <!-- end of waveControls-->
        

      <div class="volSliderDiv" id="volSliderDiv2">
        <span>Amplitude</span><br>
        <input class="volSlider" type="range" id="volumeSlider2" min="0" max="2" value="1" step="0.01" oninput="if(wave2on){changeVol(2);}">
      </div> <!-- end of volSlider-->

    

      <div class="waveformCanvasDiv" id="waveformCanvasDiv2">
        <canvas id="waveCanvas2" class="waveCanvas"></canvas>
      </div> <!-- end of waveformCanvas -->


      <div class="freqSliderDiv" id="freqSliderDiv2">
        <span>Frequency: </span>
        <input id="freqSlider2" type="range" min="0" max="1500" value="880" style="width:330px" oninput="updateFreqTextBox(2);if(wave2on){changeFreq(2);}">
        <input id="freqText2" type="text" class="textBox" value="880" onchange="updateFreqSlider(2);if(wave2on){changeFreq(2);}">
      </div> <!-- end of freqSlider -->
      <!-- end of wave2 -->



    <!-- combined -->
      <div class="waveControlsDiv" id="waveControlsDiv3">
        <div><!-- start of control buttons-->
          <button class="controlButtons" onclick="drawCombinedWaves()">Mixed waves</button>
        </div> <!-- end of controlButtons-->
      </div> <!-- end of waveControls-->

       <div class="waveformCanvasDiv" id="waveformCanvasDiv3">
        <canvas id="waveCanvasCombined" class="waveCanvas"></canvas>
      </div> <!-- end of waveformCanvas -->
   </div> <!-- end of content -->


  </body>


<script>

// vars are global (for now) so I don't have to think about scope
// in most online examples these are const, but they can't be set until user
// initiates action (button press), so they're declared here and initialized
// elsewhere
var o1, o2;
var audioCtx;
var gainNode1;
var gainNode2;
var analyser1;
var analyser2;
var wave1on = false;
var wave2on = false;

// set up canvases
var canvas1 = document.getElementById('waveCanvas1');
var canvasCtx1 = canvas1.getContext('2d');
var canvas2 = document.getElementById('waveCanvas2');
var canvasCtx2 = canvas2.getContext('2d');
var canvasCombined = document.getElementById('waveCanvasCombined');
var canvasCtxCombined = canvasCombined.getContext('2d');

// sometimes need to delay before redrawing wave (ms)
var waveDrawDelay = 500;

//  the setup has to be user initiated (button press)
function init() {
  // create web audio api context
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();

  // create gainNodes, set gain
  gainNode1 = audioCtx.createGain();
  gainNode1.gain.value = 1.0;
  gainNode2 = audioCtx.createGain();
  gainNode2.gain.value = 1.0;

   // create analysers for visualization
  analyser1 = audioCtx.createAnalyser();
  analyser2 = audioCtx.createAnalyser();

  // oscillators are created when "start" buttons pressed
  // contexts are connected then too (osc->gain->analyser->dest)

}

function startWave1(){
  // make sure audioCtx is initialized first
  if(!audioCtx){
    init();
  }

  // a new oscillator has to be created every time one is started
  // make sure the old one is stopped in case play is hit multiple times
  if (wave1on){o1.stop();}
  o1 = audioCtx.createOscillator();
  
  var freq, waveType
  // set freq and wave type
  waveType = document.getElementById('waveform1').value;
  o1.type = waveType;
  freq = document.getElementById('freqSlider1').value;
  o1.frequency.setValueAtTime(freq, audioCtx.currentTime); // value in hertz

  // set volume
  newVol = document.getElementById('volumeSlider1').value;
  gainNode1.gain.value = newVol;
  

  // connect everything osc->gain->analyser->dest
  o1.connect(gainNode1);
  gainNode1.connect(analyser1);
  analyser1.connect(audioCtx.destination);

  o1.start();
  wave1on = true;
  // needs a delay before it will draw
  setTimeout(function(){
    drawWave1();
  }, waveDrawDelay); 

  setTimeout(function(){
      drawCombinedWaves();
    }, waveDrawDelay); 

}

function startWave2(){
  // make sure audioCtx is initialized first
  if(!audioCtx){
    init();
  }

  // a new oscillator has to be created every time one is started
  // make sure the old one is stopped in case play is hit multiple times
  if (wave2on){o2.stop();}
  o2 = audioCtx.createOscillator();

  var freq, waveType
  // set freq and wave type
  waveType = document.getElementById('waveform2').value;
  o2.type = waveType;
  freq = document.getElementById('freqSlider2').value;
  o2.frequency.setValueAtTime(freq, audioCtx.currentTime); // value in hertz

  // set volume
  newVol = document.getElementById('volumeSlider2').value;
  gainNode2.gain.value = newVol;
  

  // connect everything osc->gain->analyser->dest
  o2.connect(gainNode2);
  gainNode2.connect(analyser2);
  analyser2.connect(audioCtx.destination);

  o2.start();
  wave2on = true;
  // needs a delay before it will draw
  setTimeout(function(){
    drawWave2();
  }, waveDrawDelay); 

  setTimeout(function(){
      drawCombinedWaves();
    }, waveDrawDelay); 
}


function clearCanvas(canvas, canvasCtx){
  var w = canvas.width;
  var h = canvas.height;
  canvasCtx.clearRect(0,0,w,h);
  canvasCtx.fillStyle = '#e6e6e6';
  canvasCtx.fillRect(0, 0, w, h);
}


function drawWave1(){
  if(!audioCtx){
    alert("Nothing to visualize; start wave first");
    return;
  }

  // clear the canvas
  clearCanvas(canvas1, canvasCtx1);

  // get data
  analyser1.fftSize = 2048;
  var bufferLength1 = analyser1.frequencyBinCount;
  var dataArray1 = new Uint8Array(bufferLength1);
  analyser1.getByteTimeDomainData(dataArray1);

  visualize(canvas1,canvasCtx1,bufferLength1,dataArray1, 'rgba(0,0,255,1)');
}

function drawWave2(){
  if(!audioCtx){
    alert("Nothing to visualize; start wave first");
    return;
  }

  // clear the canvas
  clearCanvas(canvas2, canvasCtx2);

  // get data
  analyser2.fftSize = 2048;
  var bufferLength2 = analyser2.frequencyBinCount;
  var dataArray2 = new Uint8Array(bufferLength2);
  analyser2.getByteTimeDomainData(dataArray2);

  visualize(canvas2,canvasCtx2,bufferLength2,dataArray2, 'rgba(255,0,0,1)');
}



function drawCombinedWaves(){
  // clear the canvas
  clearCanvas(canvasCombined, canvasCtxCombined);
    
    analyser1.fftSize = 2048;
    var bufferLength1 = analyser1.frequencyBinCount;
    var dataArray1 = new Uint8Array(bufferLength1);
    analyser1.getByteTimeDomainData(dataArray1);
    

    analyser2.fftSize = 2048;
    var bufferLength2 = analyser2.frequencyBinCount;
    var dataArray2 = new Uint8Array(bufferLength2);
    analyser2.getByteTimeDomainData(dataArray2);

    if (wave1on && wave2on){
      var dataArrayCombined = new Uint8Array(bufferLength1);
      for(var i = 0; i < bufferLength1; i++) {
        dataArrayCombined[i] = (dataArray1[i]/2)+(dataArray2[i]/2);
      }
      visualize(canvasCombined, canvasCtxCombined, bufferLength1,dataArrayCombined, 'black');
    } 
    else { 
      if (wave1on) { // just wave1
        var dataArrayCombined = new Uint8Array(bufferLength1);
        for(var i = 0; i < bufferLength1; i++) {
          dataArrayCombined[i] = dataArray1[i];
        }
        visualize(canvasCombined, canvasCtxCombined, bufferLength1,dataArrayCombined, 'black');
      } 
      else { 
        if (wave2on){ // just wave 2
          var dataArrayCombined = new Uint8Array(bufferLength1);
          for(var i = 0; i < bufferLength1; i++) {
            dataArrayCombined[i] = dataArray2[i];
          }
          visualize(canvasCombined, canvasCtxCombined, bufferLength1,dataArrayCombined, 'black');
        }
        else{ // no wave on
          var dataArrayCombined = new Uint8Array(bufferLength1);
          for(var i = 0; i < bufferLength1; i++) {
            dataArrayCombined[i] = 128;
          }
          visualize(canvasCombined, canvasCtxCombined, bufferLength1,dataArrayCombined, 'black');
        }
      }
    }
}


function visualize(canvas, canvasCtx, bufferLength, dataArray, color){
  
  var w = canvas.width;
  var h = canvas.height;

	// define draw function to be repeatedly called (if wanted, uncomment second line)
	var draw = function(){
		    //drawVisual = requestAnimationFrame(draw);
        
        canvasCtx.lineWidth = 2;
        canvasCtx.strokeStyle = color;
        canvasCtx.beginPath();
        var sliceWidth = w * 1.0 / bufferLength;
        var x = 0;

        for(var i = 0; i < bufferLength; i++) {
        	var v = dataArray[i] / 128.0;
         	var y = v * h/2;
         	if(i === 0) {
            canvasCtx.moveTo(x, y);
          	} else {
            	canvasCtx.lineTo(x, y);
          	}
          	x += sliceWidth;
        }

        canvasCtx.lineTo(canvas.width, canvas.height/2);
        canvasCtx.stroke();
	};

	draw();

}

function stopWave(waveNum){
  if (waveNum == 1){
    o1.stop();
    o1.disconnect(); // garbage collection
    wave1on = false;
    // clear canvas
    //clearCanvas(canvas1, canvasCtx1);
  } else if (waveNum == 2){
    o2.stop();
    o2.disconnect(); // garbage collection
    wave2on = false;
    // clear canvas
    //clearCanvas(canvas2, canvasCtx2);
  }
  
}

function updateFreqTextBox(waveNum){
  if (waveNum == 1){
    newFreq = document.getElementById('freqSlider1').value;
    document.getElementById('freqText1').value = newFreq;
  } else if (waveNum ==2){
    newFreq = document.getElementById('freqSlider2').value;
    document.getElementById('freqText2').value = newFreq;
  }
}
function changeFreq(waveNum){
  // redraw the wave after frequency changed 
  var newFreq;
  if (waveNum == 1){
    newFreq = document.getElementById('freqSlider1').value;
    o1.frequency.setValueAtTime(newFreq, audioCtx.currentTime);
    updateFreqTextBox(1);
    setTimeout(function(){
      drawWave1();
    }, waveDrawDelay); 
  } else{
    newFreq = document.getElementById('freqSlider2').value;
    o2.frequency.setValueAtTime(newFreq, audioCtx.currentTime);
    updateFreqTextBox(2);
    setTimeout(function(){
      drawWave2();
    }, waveDrawDelay); 
  }
  setTimeout(function(){
      drawCombinedWaves();
    }, waveDrawDelay); 
}

function changeVol(waveNum){
  // redraw the wave after volume changed 
  var newVol;
  if (waveNum == 1){
    newVol = document.getElementById('volumeSlider1').value;
    gainNode1.gain.value = newVol;
    setTimeout(function(){
      drawWave1();
    }, waveDrawDelay); 
  } else {
    newVol = document.getElementById('volumeSlider2').value;
    gainNode2.gain.value = newVol;
    setTimeout(function(){
      drawWave2();
    }, waveDrawDelay); 
  }
  setTimeout(function(){
      drawCombinedWaves();
    }, waveDrawDelay); 
}

function changeWave(waveNum){
  // redraw the wave after wave type changed 
  var waveType;
  if (waveNum == 1){
    waveType = document.getElementById('waveform1').value;
    o1.type = waveType;
    setTimeout(function(){
      drawWave1();
    }, waveDrawDelay); 
  } else {
    waveType = document.getElementById('waveform2').value;
    o2.type = waveType;
    setTimeout(function(){
      drawWave2();
    }, waveDrawDelay); 
  }
  setTimeout(function(){
      drawCombinedWaves();
    }, waveDrawDelay); 
  
}


  </script>
</html>
